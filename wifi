#!/bin/bash
# @Jinn

# check root
if [ $UID -ne 0 ]; then
    echo "don't try to run this without superuser powers"
    exit 1
fi

echo "get available aps"
avail=`iwlist wlan0 scan | grep -i -e essid | sed 's/.*:"\(.*\)".*/\1/'`
IFS='
'
aps=`cat /home/imrahil/.wifisec | sed 's/.*,\(.*\),.*/\1/'`
#aps=`cat `$HOME`/.wifisec | sed 's/.*,\(.*\),.*/\1/'`

br=0
ap=""

echo "search one to connect"
for i in $avail; do
    for j in $aps; do
        if [ "$i" == "$j" ]; then
            echo "found ap $i"
            ap=`cat ~/.wifisec | grep $i | sed 's/\(.*\),.*,.*/\1'/`
            br=1
            break
        fi
    done
    if [ $br -eq 1 ]; then
        break
    fi
done

if [ "$ap" != "" ]; then
    /scripts/wpa_connect -n $ap
fi